#### 1. 简单使用

##### 1.1. 后端代码

npm init -y
npm i ws 

新建 server.js 文件，使用 node server.js 运行

```js
const WebSocket = require("ws");
const wss = new WebSocket.Server({ port: 3000 });

wss.on("connection", (ws) => {
  console.log("前端连接进来了");

  ws.on("message", (data) => {
    console.log("后端接收到来自前端的数据：", data);
    ws.send("服务器数据");
  });

  ws.on("close", () => {
    console.log("前端断开连接");
  });
});
```

##### 1.2. 前端代码

```html
<script>
  const ws = new WebSocket("ws://localhost:3000");
  ws.addEventListener("open", () => {
    console.log("连上服务器了");
    ws.send("前端数据");
  });
  ws.addEventListener("message", ({ data }) => {
    console.log(data);
  });
</script>
```



#### 2. Socket.io 库

https://socket.io/

https://www.w3cschool.cn/socket/socket-k49j2eia.html

https://blog.csdn.net/Frank__Dong/article/details/120348115

##### 2.1. 后端代码

npm init -y

npm i express socket.io

```js
// server.js
const app = require("express")();
const server = require("http").createServer(app);
const { Server } = require("socket.io");
const io = new Server(server);

app.get("/", (req, res) => {
  res.sendFile(__dirname + "/index.html"); // 访问 localhost:3000 直接返回前端代码
});

io.on("connection", (socket) => {
  console.log("连接成功");
  socket.on("chat message", (msg) => {
    console.log(msg);
    io.emit("chat message", "服务器发送数据：" + msg); // 简单拼接，发送数据给前端
  });
  socket.on("disconnect", () => {
    console.log("断开连接");
  });
});

server.listen("3000", () => "服务器开启");
```

##### 2.2. 前端代码

```html
<body>
  <form>
    <input type="text" />
    <button>发送</button>
  </form>
  <ul></ul>
  <!-- 因为和服务器代码放在一起，所以可以直接引入 socket.io 文件，猜测是引入的 node_modules 中的文件 -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const form = document.querySelector("form");
    const input = document.querySelector("input");
    const ul = document.querySelector("ul");

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (input.value) {
        socket.emit("chat message", input.value);  // 发送 socket 请求，请求名可以随意区
        input.value = "";
      }
    });
    socket.on("chat message", (msg) => {  // 监听 socket 请求
      const li = document.createElement("li");
      li.textContent = msg;
      ul.appendChild(li);
    });
  </script>
</body>
```



