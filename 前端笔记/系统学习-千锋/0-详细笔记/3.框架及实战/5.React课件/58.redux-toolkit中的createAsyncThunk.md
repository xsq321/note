## ä¸€ã€æ¦‚å¿µ
createAsyncThunk æ˜¯ä¸€ä¸ªç”± Redux Toolkit æä¾›çš„å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå¤„ç†å¼‚æ­¥æ“ä½œçš„ thunk action creatorã€‚ä½¿ç”¨ createAsyncThunk å¯ä»¥ç®€åŒ– Redux ä¸­å¤„ç†å¼‚æ­¥æ“ä½œçš„æµç¨‹ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€‚
## äºŒã€å‚æ•°è¯´æ˜
```tsx
import { createAsyncThunk } from "@reduxjs/toolkit";

const myAsyncThunk = createAsyncThunk(
  /**
   * ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ action åç§°ï¼Œç”¨äºåœ¨ Redux ä¸­è¯†åˆ«è¯¥ actionã€‚
   * è¯¥åç§°é€šå¸¸åŒ…å«æ“ä½œåç§°å’ŒçŠ¶æ€
   *  */
  "myAsyncOperationStatus",
  /**
   * æ­¥æ“ä½œå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°
   * ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ thunk çš„ payloadï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨çš„æ—¶å€™ä¼ è¿‡æ¥çš„
   * ç¬¬äºŒä¸ªå‚æ•°æ˜¯thunkå¯¹è±¡
   * dispatch
   * ç”¨äº dispatch å…¶ä»– action çš„å‡½æ•°
   * getState
   * ç”¨äºè·å–å½“å‰ Redux store ä¸­çš„ state çš„å‡½æ•°
   * extra
   * æ€§æ˜¯ç”¨äºä¼ é€’é¢å¤–å‚æ•°çš„å¯¹è±¡
   * 
   */
  async (arg, { dispatch, getState, extra }) => {
    // å¼‚æ­¥æ“ä½œå‡½æ•°ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ª Promise
    const response = await fetch("https://example.com/api/someEndpoint");
    return response.json();
  },
  {} // å¯é€‰çš„é…ç½®é¡¹
);

```
## ä¸‰ã€ä¾‹å­
ç‚¹å‡»æŒ‰é’®ageå»¶è¿Ÿ1ç§’å+1ï¼Œåœ¨å»¶è¿Ÿçš„æ—¶å€™ï¼Œæ˜¾ç¤ºloadingã€‚å¶æ•°çš„æ—¶å€™æ˜¾ç¤ºæŠ¥é”™ï¼Œå¹¶æ˜¾ç¤ºæç¤ºä¿¡æ¯
### 1ã€åœ¨actionç›®å½•çš„user.jsæ–‡ä»¶æ·»åŠ ä¸€ä¸‹ä»£ç 
```jsx
import { createAction, createAsyncThunk } from "@reduxjs/toolkit";

const dely = () => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve();
    }, 1000);
  });
};

export const ageAddAsync = createAsyncThunk(
  "user/ageAddAsync",
  async (arg, { dispatch, getState, extra }) => {
    const { user } = getState();
    console.log(user.age);
    await dely();
    // å¶æ•°çš„æ—¶å€™æŠ›é”™
    if (user.age % 2 === 0) {
      throw new Error("å¶æ•°çš„æ—¶å€™æŠ›é”™")
    }
  }
);

```
### 2ã€ä¿®æ”¹sliceç›®å½•é‡Œçš„user.jsæ¨¡å—
```jsx
import { createSlice } from "@reduxjs/toolkit";
import { ageAddAsync } from "./../actions/user";

const userSlice = createSlice({
  // åˆ‡ç‰‡å å¿…é¡»å…¨å±€å”¯ä¸€
  name: "user",
  // åˆå§‹åŒ–çŠ¶æ€
  initialState: {
    age: 1,
    name: "æå››",
    status: "",
    error: "",
  },

  reducers: {
    /**
     *
     * @param {*} state å½“å‰çš„state
     * @param {*} action ç©¿è¿‡æ¥çš„å‚æ•°
     */
    addAge(state, action) {
      return {
        ...state,
        age: state.age + 1,
      };
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase("user/updateName", (state, action) => {
        state.name = action.payload.name;
      })
      // å¼‚æ­¥æ–¹æ³•çš„peddingçŠ¶æ€
      .addCase(ageAddAsync.pending, (state) => {
        state.status = "loading";
      })
      // å¼‚æ­¥æ–¹æ³•çš„æˆåŠŸçš„çŠ¶æ€
      .addCase(ageAddAsync.fulfilled, (state, action) => {
        state.age += 1;
        state.status = "successed";
        state.error = ''
      })
      /**
       * state
       * action å½“å‰çš„é”™è¯¯ä¿¡æ¯
       */
      .addCase(ageAddAsync.rejected, (state, action) => {
        console.log(action)
        state.status = "error";
        state.age += 1
        state.error = action.error.message;
      });
  },
});

/**
 * å¯¼å‡ºsliceæ¨¡å—çš„reducer
 */
export default userSlice.reducer;

/**
 * ç›´æ¥å¯¼å‡ºactionsæ¨¡å—
 * è¿™ä¸ªactionsé‡Œé¢çš„æ–¹æ³•å’Œreduceré‡Œçš„æ–¹æ³•å
 * ä¸€è‡´ï¼Œç›´æ¥å¯¹è±¡è§£æ„
 */
export const { addAge } = userSlice.actions;

```
### 3ã€æŒ‚è½½åˆ°configureStore
```jsx
import { configureStore, createSlice } from "@reduxjs/toolkit";
import user from './slice/user';

const store = configureStore({
  reducer: {
    user
  },
});

export default store;

```
### 4ã€é¡µé¢ä¸­ä½¿ç”¨
```jsx
import { useSelector, useDispatch } from "react-redux";
import { ageAddAsync } from "./store/actions/user";

export default function LearnReduxToolkit4() {
  const user = useSelector((state) => state.user);
  const dispatch = useDispatch();

  return (
    <div>
      <div>
        {user.name}--{user.age}
      </div>
      <div>{user.status}</div>
      <div>{user.error}</div>
      {/* <div>å¶æ•°æŠ›å‡ºé”™è¯¯</div> */}
      <button onClick={() => dispatch(ageAddAsync())}>å»¶è¿Ÿä¸€ç§’+1</button>
    </div>
  );
}

```
## å››ã€å°æ€è€ƒ
å¯ä»¥ä¸å¯ä»¥å°è£…ä¸€ä¸‹createSliceå’ŒcreateAsyncThunkï¼Œè®©è°ƒç”¨å˜å¾—æ›´ç®€å•ğŸ¤”
