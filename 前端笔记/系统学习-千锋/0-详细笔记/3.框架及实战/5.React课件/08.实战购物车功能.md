## 1、样例
![image.png](https://cdn.nlark.com/yuque/0/2022/png/12928539/1665322241811-0667d7ba-5e7e-4409-abb8-2549ef1129ab.png#averageHue=%23ececec&clientId=ua1a049a5-275a-4&errorMessage=unknown%20error&from=paste&height=191&id=uc7fc3175&name=image.png&originHeight=438&originWidth=1398&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75415&status=error&style=none&taskId=u378fcd78-b7c5-46ac-b018-3b217589532&title=&width=611)
## 2、需求

- [ ] 单选全选功能，并且可以互相联动
- [ ] 小计功能
- [ ] 总计功能
- [ ] 商品加减，数量为零时不能在减
## 3、代码
```jsx
import React from "react";

export default class ShopCart extends React.Component {
  state = {
    /**
     * 购物车的商品数据
     */
    goods: [
      {
        name: "羊肉串",
        price: 20,
      },
      {
        name: "猪肉串",
        price: 10,
      },
      {
        name: "鸡肉串",
        price: 5,
      },
    ],
    isAllSelect: false,
  };

  /**
   * 对商品数量进行操作
   * @param {*} index 当前操作商品的下标
   * @param {*} num 1 或 -1
   */
  updateNum(index, num) {
    /**
     * 首先对num进行初始化操作
     */
    this.state.goods[index].num = this.state.goods[index].num || 1;

    /**
     * 给num进行+1 或 -1
     */
    this.state.goods[index].num += num;

    /**
     * 渲染视图
     */
    this.setState({
      goods: this.state.goods,
    });
  }

  /**
   * 全选变化的回调
   */
  allSelectChange() {
    // 给我们的全选状态取非
    this.state.isAllSelect = !this.state.isAllSelect;

    // 同步所有商品的选择状态
    this.state.goods.forEach((item) => {
      // 所有的单选状态和全选状态保持一致
      item.select = this.state.isAllSelect;
    });

    // 渲染视图
    this.setState({
      isAllSelect: this.state.isAllSelect,
      goods: this.state.goods,
    });
  }

  /**
   * 单选按钮发生变化后触发
   * @param {*} index
   */
  singleSelect(index) {
    /**
     * 给当前选择的商品取非
     */
    this.state.goods[index].select = !this.state.goods[index].select;

    // 联动全选状态
    /**
     * every 的返回值 取决于回调函数里面的返回值是不是都为true
     * 如果有一个为false那么整个every的返回结果就为false
     */
    const isAllSelect = this.state.goods.every((item) => item.select);

    /**
     * 渲染视图
     */
    this.setState({
      goods: this.state.goods,
      // es6 简写的语法 相当于 isAllSelect: isAllSelect
      isAllSelect,
    });
  }

  render() {
    return (
      <div>
        <div>购物车</div>

        <div>
          全选{" "}
          <input
            type="checkbox"
            onChange={() => this.allSelectChange()}
            checked={this.state.isAllSelect}
          />
          <div>
            {this.state.goods.map((item, index) => (
              <div key={index}>
                {/* 
                  每天数据的选中情况都适用select这个字段表示
                  我们并没有定义select那么初始化的时候select为undefined

                  如果我们把一个表单控件变成受控组件后，要注意手动的更新这个值

                */}
                <input
                  type="checkbox"
                  onChange={() => this.singleSelect(index)}
                  checked={item.select || false}
                />
                商品名：{item.name} --- 商品价格: {item.price} ---
                {/* 
                  本质上来说 加 和 减的逻辑是一样
                  都是对num进行赋值操作
                  既然逻辑一样，我们就可以把他写在一个函数里面

                */}
                <button onClick={() => this.updateNum(index, 1)}>+</button>
                {/* 
                  当我们直接使用 item.num的时候
                  页面上会显空，因为我们没有定义num这个数据
                    直接取值 是undefined
                */}
                {item.num || 1}
                <button onClick={() => this.updateNum(index, -1)}>-</button>
                小计: {item.price * (item.num || 1)}
              </div>
            ))}
          </div>
          {/* 
            先找到所有已选中的商品
            把他们的小计累加起来
            小计是有 单加*数量构成
          
          */}
          <div>
            总计：
            {this.state.goods
              .filter((item) => item.select)
              .reduce((total, item) => {
                return (total += item.price * (item.num || 1));
              }, 0)}
          </div>
        </div>
      </div>
    );
  }
}

```
