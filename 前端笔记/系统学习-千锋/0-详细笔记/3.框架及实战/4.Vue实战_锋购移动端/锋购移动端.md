# ä¸€ã€åˆå§‹åŒ–é¡¹ç›®

## 1ã€é¡¹ç›®ä»‹ç»

ç§»åŠ¨ç”µå•†é¡¹ç›®â€”é”‹è´­ã€‚

æŠ€æœ¯æ ˆï¼šVue3(composition api) + Pinia + Vue Router4.x+Vant 4

è¾…åŠ©æ’ä»¶ï¼šaxios+sass+lodash+store

```bash
npm i axios store lodash @types/lodash -S
npm i sass  -D
```





## 2ã€é¡¹ç›®åˆ›å»º

```sh
npm init vue@latest

fenggou_mobile
```



![é¡¹ç›®åˆ›å»º](images/é¡¹ç›®åˆ›å»º.png)



### æ­é… TypeScript ä½¿ç”¨ Vue

https://cn.vuejs.org/guide/typescript/overview.html



#### æ’ä»¶å®‰è£…

- [Volar](https://marketplace.visualstudio.com/items?itemName=Vue.volar) æ˜¯å®˜æ–¹çš„ VSCode æ‰©å±•ï¼Œæä¾›äº† Vue å•æ–‡ä»¶ç»„ä»¶ä¸­çš„ TypeScript æ”¯æŒï¼Œè¿˜ä¼´éšç€ä¸€äº›å…¶ä»–éå¸¸æ£’çš„ç‰¹æ€§ã€‚

  > Volar å–ä»£äº†æˆ‘ä»¬ä¹‹å‰ä¸º Vue 2 æä¾›çš„å®˜æ–¹ VSCode æ‰©å±• [Vetur](https://marketplace.visualstudio.com/items?itemName=octref.vetur)ã€‚å¦‚æœä½ ä¹‹å‰å·²ç»å®‰è£…äº† Veturï¼Œè¯·ç¡®ä¿åœ¨ Vue 3 çš„é¡¹ç›®ä¸­ç¦ç”¨å®ƒã€‚

- [TypeScript Vue Plugin](https://marketplace.visualstudio.com/items?itemName=Vue.vscode-typescript-vue-plugin) ç”¨äºæ”¯æŒåœ¨ TS ä¸­ import `*.vue` æ–‡ä»¶ã€‚



![æ’ä»¶1](images/æ’ä»¶1.png)



![æ’ä»¶2](images/æ’ä»¶2.png)



#### è£…å®Œ Volarä¼šå¼€å¯

å…³é—­ç‚¹å‡»äº‹ä»¶ï¼š$event

![å…³é—­$event](images/å…³é—­$event.png)



### æŠ¥é”™å¤„ç†

åœ¨ `.ts` æ–‡ä»¶ä¸­ï¼Œ æŠ¥é”™æç¤º æ‰¾ä¸åˆ°æ¨¡å—â€œ./XXX.vueâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜

![æ‰¾ä¸åˆ°æ¨¡å—](images/æ‰¾ä¸åˆ°æ¨¡å—.png)

æŠ¥é”™åŸå› ï¼štypescript åªèƒ½ç†è§£ .ts æ–‡ä»¶ï¼Œæ— æ³•ç†è§£ .vueæ–‡ä»¶

**è§£å†³ï¼šenv.d.ts:**

```js
declare module "*.vue" {
  import { App, defineComponent } from "vue";
  const component: ReturnType<typeof defineComponent> & {
    install(app: App): void;
  };
  export default component;
}
```



### è‡ªåŠ¨å¯¼å…¥è®¾ç½®

å°¤å¤§æ¨èçš„ç¥å™¨ unplugin-vue-components ï¼Œè§£æ”¾åŒæ‰‹ï¼ä»¥åå†ä¹Ÿä¸ç”¨å‘†å‘†çš„æ‰‹åŠ¨å¼•å…¥ç»„ä»¶ã€ui(Element-ui)åº“ã€æˆ–è€… vue hooksç­‰äº†ã€‚

å®‰è£…ï¼š

```bash
npm install unplugin-vue-components -D
```



ç›´æ¥å†™ç»„ä»¶åå³å¯ï¼Œæ’ä»¶ä¼šå¸®ä½ å¼•å…¥è¿›æ¥ **æ³¨æ„åˆ«é‡å**

```js
// vite.config.js
import { defineConfig } from 'vite'
import Components from 'unplugin-vue-components/vite'
import { VantResolver } from "unplugin-vue-components/resolvers";

export default defineConfig({
  plugins: [
    vue(),
    Components({
      // æŒ‡å®šç»„ä»¶ä½ç½®ï¼Œé»˜è®¤æ˜¯src/components
      dirs: ['src'],
     // ç»„ä»¶çš„æœ‰æ•ˆæ–‡ä»¶æ‰©å±•åã€‚
      extensions: ["vue"],
      // æœç´¢å­ç›®å½•
      deep: true,
      // uiåº“è§£æå™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰
      // resolvers: [VantResolver()],
      // é…ç½®æ–‡ä»¶ç”Ÿæˆä½ç½®
      dts: 'src/components.d.ts'
    })
  ]
})
```

æ’ä»¶ä¼šç”Ÿæˆä¸€ä¸ªè‡ªå·±ç»„ä»¶è·¯å¾„çš„components.d.tsæ–‡ä»¶

```js
// components.d.ts

// generated by unplugin-vue-components
// We suggest you to commit this file into source control
// Read more: https://github.com/vuejs/vue-next/pull/3399

declare module 'vue' {
  export interface GlobalComponents {
    BaseFilter: typeof import('./components/Common/BaseFilter.vue')['default']
    BaseHeader: typeof import('./components/Common/BaseHeader.vue')['default']
    BasePagination: typeof import('./components/Common/BasePagination.vue')['default']
    BaseSidebar: typeof import('./components/Common/BaseSidebar.vue')['default']
    BaseTags: typeof import('./components/Common/BaseTags.vue')['default']
    BaseTitle: typeof import('./components/Common/BaseTitle.vue')['default']
  }
}

export { }

```





## 3ã€åˆå§‹åŒ–æ ·å¼

#### å®‰è£…sass

```bash
npm i sass  -D
```

#### assets/css/index.scss

```scss
@import "./_reset";
@import "./_vant";
@import './layout'
```

#### main.ts

```ts
import "@/assets/css/index.scss";
```

#### _vant.scss

```css

```

#### _layout.scss

```scss
// å°è£…å…¬å…±çš„çº¢è‰²èƒŒæ™¯å¯¼èˆªæ¡
```

#### _reset.scss

```scss
* {
  margin: 0;
}

html,
body,
#app {
  height: 100%;
  max-width: 750px;
  margin: 0 auto;
}
body{
  font-size: 14px;
}
```





## 4ã€Vantç»„ä»¶åº“

å®˜ç½‘åœ°å€ï¼šhttps://vant-contrib.gitee.io/vant/#/zh-CN/quickstart

### å®‰è£…

```sh
# Vue3 é¡¹ç›®ï¼Œå®‰è£…æœ€æ–°ç‰ˆ Vant
npm i vant -S
```



#### é…ç½®æŒ‰éœ€å¼•å…¥

å®‰è£…æ’ä»¶ [unplugin-vue-components](https://github.com/antfu/unplugin-vue-components), å®ƒå¯ä»¥è‡ªåŠ¨å¼•å…¥ç»„ä»¶ï¼Œå¹¶æŒ‰éœ€å¼•å…¥ç»„ä»¶çš„æ ·å¼ã€‚ç›¸æ¯”äºåŸºç¡€ç”¨æ³•ï¼Œè¿™ç§æ–¹å¼å¯ä»¥æŒ‰éœ€å¼•å…¥ç»„ä»¶çš„ CSS æ ·å¼ï¼Œä»è€Œå‡å°‘ä¸€éƒ¨åˆ†ä»£ç ä½“ç§¯ã€‚

```sh
npm i unplugin-vue-components -D
```

åŸºäº `vite` çš„é¡¹ç›®ï¼Œåœ¨ `vite.config.js` æ–‡ä»¶ä¸­é…ç½®æ’ä»¶ï¼š

```diff
// ...
// æ·»åŠ 
+import Components from 'unplugin-vue-components/vite';
+import { VantResolver } from 'unplugin-vue-components/resolvers';

export default {
  plugins: [
    // ...
    // æ·»åŠ 
+    Components({
+      resolvers: [VantResolver()],
+    }),
  ],
};

```

#### ä½¿ç”¨

å®Œæˆä»¥ä¸Šä¸¤æ­¥ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ Vant ç»„ä»¶äº†ï¼Œ`unplugin-vue-components` ä¼šè§£ææ¨¡æ¿å¹¶è‡ªåŠ¨æ³¨å†Œå¯¹åº”çš„ç»„ä»¶ã€‚

```vue
<template>
  <van-button type="primary" />
</template>
```



### å‡½æ•°ç»„ä»¶çš„æ ·å¼

Vant ä¸­æœ‰ä¸ªåˆ«ç»„ä»¶æ˜¯ä»¥å‡½æ•°çš„å½¢å¼æä¾›çš„ï¼ŒåŒ…æ‹¬ `Toast`ï¼Œ`Dialog`ï¼Œ`Notify` å’Œ `ImagePreview` ç»„ä»¶ã€‚åœ¨ä½¿ç”¨å‡½æ•°ç»„ä»¶æ—¶ï¼Œ`unplugin-vue-components` æ— æ³•è‡ªåŠ¨å¼•å…¥å¯¹åº”çš„æ ·å¼ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å¼•å…¥æ ·å¼ã€‚

```ts
// main.ts
import 'vant/es/toast/style'
import 'vant/es/dialog/style';
import 'vant/es/notify/style';
import 'vant/es/image-preview/style';
```

ä½ å¯ä»¥åœ¨é¡¹ç›®çš„å…¥å£æ–‡ä»¶æˆ–å…¬å…±æ¨¡å—ä¸­å¼•å…¥ä»¥ä¸Šç»„ä»¶çš„æ ·å¼ï¼Œè¿™æ ·åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œä¾¿ä¸å†éœ€è¦é‡å¤å¼•å…¥æ ·å¼äº†ã€‚



### å®šåˆ¶ä¸»é¢˜

#### æ–¹å¼ä¸€ï¼šé€šè¿‡ CSS è¦†ç›–

é»˜è®¤å€¼è¢«å®šä¹‰åœ¨ `:root` èŠ‚ç‚¹ä¸Šï¼ŒHTML é‡Œçš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½å¯ä»¥è®¿é—®åˆ°è¿™äº›å˜é‡ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­è¦†ç›–è¿™äº› CSS å˜é‡ï¼ŒButton ç»„ä»¶çš„æ ·å¼ä¼šéšä¹‹å‘ç”Ÿæ”¹å˜ï¼š

##### _vant.scss

```css
/* æ·»åŠ è¿™æ®µæ ·å¼åï¼ŒPrimary Button ä¼šå˜æˆçº¢è‰² */
:root:root {
  --van-button-primary-background: red;
}
```

æµ‹è¯•ï¼š

```vue
<van-button type="primary" />
```



#### æ–¹å¼äºŒï¼šé€šè¿‡ ConfigProvider è¦†ç›–

`ConfigProvider` ç»„ä»¶æä¾›äº†è¦†ç›– CSS å˜é‡çš„èƒ½åŠ›ï¼Œä½ éœ€è¦åœ¨æ ¹èŠ‚ç‚¹åŒ…è£¹ä¸€ä¸ª `ConfigProvider` ç»„ä»¶ï¼Œå¹¶é€šè¿‡ `theme-vars` å±æ€§æ¥é…ç½®ä¸€äº›ä¸»é¢˜å˜é‡ã€‚

##### åœ¨ TypeScript ä¸­ä½¿ç”¨

åœ¨ TypeScript ä¸­å®šä¹‰ themeVars æ—¶ï¼Œå»ºè®®ä½¿ç”¨ Vant æä¾›çš„ `ConfigProviderThemeVars` ç±»å‹ï¼Œå¯ä»¥æä¾›å®Œå–„çš„ç±»å‹æç¤ºï¼š

##### src/config/theme.ts

```ts
import type { ConfigProviderThemeVars } from "vant";

export const themeVars:ConfigProviderThemeVars={
  rateIconFullColor: '#07c160',
      sliderBarHeight: '4px',
      sliderButtonWidth: '20px',
      sliderButtonHeight: '20px',
      sliderActiveBackground: '#07c160',
      buttonPrimaryBackground: '#07c160',
      buttonPrimaryBorderColor: '#07c160',
      buttonPrimaryBackground: "#d30707", // button èƒŒæ™¯é¢œè‰²
      buttonPrimaryBorderColor: "#ccc", // button è¾¹æ¡†é¢œè‰²
      dropdownMenuTitleActiveTextColor: "#d30707", // ä¸‹æ‹‰èœå•é€‰ä¸­é¢œè‰²
  	  dropdownMenuOptionActiveColor: "#d30707",
}
```



##### æµ‹è¯•ï¼šApp.vue

```vue
<template>
  <van-config-provider :theme-vars="themeVars">
    <van-button type="primary" />
    <RouterView />

    <RouterView name="footer" />
  </van-config-provider>
</template>

<script setup lang="ts">
import { themeVars } from "./config/theme";
</script>
```





## 5ã€ç§»åŠ¨ç«¯é¡¹ç›®

### è®¾è®¡ç›¸å…³

æ ¹æ®è®¾è®¡äººå‘˜äº§å‡ºçš„è®¾è®¡å›¾è¿›è¡Œé¡µé¢å¼€å‘ã€‚æ ‡æ³¨å›¾

https://www.figma.com/



### ç§»åŠ¨ç«¯å¸ƒå±€

rem åšé€‚é…ï¼š

ç§»åŠ¨ç«¯è®¾è®¡å›¾å¤§éƒ¨åˆ†éƒ½æ˜¯750å®½ã€‚è®¾è®¡å¸ˆä¼šæ ¹æ®iPhoneå°ºå¯¸æ¥è¿›è¡Œè®¾è®¡ï¼ˆiphone6ï¼‰ã€‚è®¾å¤‡æ˜¯375pxï¼Œè¿™æ˜¯å› ä¸ºç§»åŠ¨ç«¯å±å¹•éƒ½æ˜¯Retinaå±å¹•ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ‰€è°“çš„äºŒå€å±å¹•ã€‚

è®¾è®¡å›¾ä¸Šé‡åˆ°çš„å°ºå¯¸ï¼Œæ”¾åˆ°cssä¸­åº”è¯¥é™¤ä»¥2ã€‚

åœ¨å±å¹•750å®½çš„æ—¶å€™ï¼Œ1rem=100pxï¼Œå½“å±å¹•ä¸º100vwå®½æ—¶å€™ï¼Œ1rem=ï¼Ÿ

750/100=100vw/x   x=10000vm/750=13.3333333333vw

```css
html,
body,
#app {
  height: 100%;
  max-width: 750px;
  margin: 0 auto;
}
body{
  font-size: 14px;
}
html{
  font-size: 13.333333333vw;
}
```





# äºŒã€åº•éƒ¨å¯¼èˆª

## æ•ˆæœå›¾

Â·<img src="images/é¦–é¡µ.png" alt="é¦–é¡µ" style="zoom:50%;" />





## å¸ƒå±€

### App.vue

```vue
<template>
  <van-config-provider :theme-vars="themeVars">
    <main class="app-container">
      <RouterView />
    </main>
    <!-- åº•éƒ¨ -->
    <CommonFooter />
  </van-config-provider>
</template>

<script setup lang="ts">
import { themeVars } from "./config/theme";
</script>

<style lang="scss" scoped>
.app-container {
  padding-top: 45px;
}
</style>
```



**components/CommonFooter/index.vue**



## è·¯ç”±é…ç½®

### router/index.ts

```ts
import { createRouter, createWebHistory } from 'vue-router'
import AppMain from '@/views/AppMain/index.vue'
import AppCart from '@/views/AppCart/index.vue'
import AppMine from '@/views/AppMine/index.vue'
import AppNotFound from '@/views/AppNotFound/index.vue'

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes:[
    {path:'/',redirect:'/main'},
    {path:'/main',name:'main',component:AppMain},
    {path:'/cart',name:'cart',component:AppCart},
    {path:'/mine',name:'mine',component:AppMine},
    { path: '/:pathMatch(.*)*', name: 'NotFound', component: AppNotFound },
  ]
})

export default router

```



### æ•è·æ‰€æœ‰è·¯ç”±æˆ– 404 Not found è·¯ç”±

https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#%E6%8D%95%E8%8E%B7%E6%89%80%E6%9C%89%E8%B7%AF%E7%94%B1%E6%88%96-404-not-found-%E8%B7%AF%E7%94%B1



### NotFound

`<img src="images/NotFound.png" alt="NotFound" style="zoom:50%;" />

å½“404é¡µé¢å±•ç¤ºæ—¶ï¼Œæ§åˆ¶åº•éƒ¨éšè—ã€‚

åº•éƒ¨å¤„ç†ï¼šä¿®æ”¹è·¯ç”±è§„åˆ™ï¼Œæ·»åŠ mataä¿¡æ¯ï¼Œå¢åŠ åˆ¤æ–­ã€‚

```diff
 { path: '/:pathMatch(.*)*', 
     name: 'NotFound', component: AppNotFound,
+     meta:{hideFooter:true}
 },
```

#### App.vue:

```vue
 <!-- NotFound ä¸æ˜¾ç¤ºåº•éƒ¨ -->
<AppFooter v-if="!route.meta.hideFooter" />
```



```js
import { type RouteLocationNormalizedLoaded, useRoute } from "vue-router";

// å–åˆ°å½“å‰è·¯ç”±çš„meta,åˆ¤æ–­æ˜¯å¦å±•ç¤ºfooter
const route: RouteLocationNormalizedLoaded = useRoute();
```



# ä¸‰ã€é¡¶éƒ¨å¯¼èˆª

### æ•ˆæœå›¾

![é¦–é¡µå¤´éƒ¨](images/é¦–é¡µå¤´éƒ¨.png)

![åˆ—è¡¨å¤´éƒ¨](images/åˆ—è¡¨å¤´éƒ¨.png)

![è¯¦æƒ…å¤´éƒ¨](images/è¯¦æƒ…å¤´éƒ¨.png)

![è´­ç‰©è½¦å¤´éƒ¨](images/è´­ç‰©è½¦å¤´éƒ¨.png)

### é™æ€å¸ƒå±€

Vant ï¼šå¯¼èˆªç»„ä»¶/NavBar å¯¼èˆªæ 

**components/CommonHeader/index.vue**

```vue
<template>
  <van-nav-bar class="app-header" title="é”‹è´­">
    <!--æ”¹æˆæ’æ§½å†™æ³•-->
    <template #left>
      <van-icon name="arrow-left" size="18">è¿”å›</van-icon>
    </template>

    <template #right>
      <van-icon name="search" size="18" />
    </template>
  </van-nav-bar>
</template>

<script setup></script>

<style lang="scss" scoped></style>
```



### æ’æ§½æ”¹é€ 

```vue
<template>
  <!-- $attrs é€ä¼ æ ·å¼ -->
  <van-nav-bar
    :class="[$attrs.class]"
    :title="title"
    :left-arrow="back"
    @click-left="backHandler"
    fixed
  >
    <!-- å·¦ä¾§æ’æ§½ -->
    <template v-if="!back" #left>
      <slot name="left" />
    </template>
    <!-- ä¸­é—´æ’æ§½ å¦‚æœtitle å±æ€§å­˜åœ¨ï¼Œå°±ä¸æ”¾æ’æ§½äº†-->
    <template v-if="!title" #title>
      <slot name="title" />
    </template>
    <!-- å³ä¾§æ’æ§½ -->
    <template #right>
      <slot name="right"></slot>
    </template>
  </van-nav-bar>
</template>

<script setup lang="ts">
import { useRouter } from "vue-router";
// import { onMounted, useAttrs } from "vue";
export interface IHeaderProps {
  title?: string;
  back?: boolean;
}

// æµ‹è¯•æ ·å¼é€ä¼ ï¼Œå…·ä½“æ ·å¼ç”±ä½¿ç”¨ç€ä¼ é€’è¿‡æ¥
// const attrs = useAttrs();
// onMounted(() => {
//   console.log("====", attrs.class);
// });

const { title, back = false } = defineProps<IHeaderProps>();

const router = useRouter();
// è¿”å›ä¸Šä¸€é¡µ
const backHandler = () => {
  // æœ‰è¿”å›çš„ï¼Œæ‰å¯ä»¥è¿”å›
  if (back) {
    router.back();
  }
};
</script>

<style lang="scss" scoped>
</style>
```



### ä½¿ç”¨ç»„ä»¶

**AppMain/index.vueï¼š**

Vantï¼šè¡¨å•ç»„ä»¶ / Searchæœç´¢ /è‡ªå®šä¹‰æŒ‰é’®

```vue
<CommonHeader class="app-common_header">
    <!-- å·¦ä¾§ -->
    <template #left>
		<van-icon name="apps-o" size="20" color="#fff"></van-icon>
    </template>
    <!-- ä¸­é—´ -->
    <template #title>
        <van-search
                    shape="round"
                    background="#d30707"
                    placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯"
                    @click="handleSearch"
                    />
    </template>
    <!-- å³ä¾§ -->
    <template #right>
		<span color="#fff">ç™»å½•</span>
    </template>
</CommonHeader>

<script setup lang="ts">
import { useRouter, type Router } from "vue-router";

const router: Router = useRouter();
// ç‚¹æœç´¢æ¡†ï¼Œè·³åˆ°æœç´¢ç•Œé¢
const handleSearch = () => {
  router.push({ name: "search" });
};
</script>
```



#### æèµ·å…¬å…±æ ·å¼ 

_layout.scss:

```scss
@import "@/assets/css/var";

// å°è£…å…¬å…±çš„çº¢è‰²èƒŒæ™¯å¯¼èˆªæ¡
.app-common_header {
  background-color: $red-color !important;
  font-weight: bold;
  .van-nav-bar__title,
  .van-nav-bar__left,
  .van-nav-bar__right {
    color: #fff;
    .van-icon {
      color: #fff;
    }
  }
  .van-search {
    padding: 0;
  }
}
```



### å…¨å±€æ³¨å†Œ

æ¯ä¸ªéƒ½å¾—éœ€è¦å¼•å…¥å…¬å…±çš„å¤´éƒ¨ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤´éƒ¨ç»„ä»¶æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨çš„åœ°æ–¹ï¼Œç›´æ¥ä½¿ç”¨ï¼Œæ— é¡»æ³¨å†Œå³å¯ã€‚

#### utils/plugins.ts

```ts
// æ³¨å†Œæˆå…¨å±€ç»„ä»¶
import CommonHeader from "@/components/CommonHeader/index.vue";
import type { App } from 'vue'

export const common={
  install(app:App){
    app.component("CommonHeader", CommonHeader);
  }
}
```

#### main.ts

```ts
import {common as commonPlugin} from '@/utils/plugins'
app.use(commonPlugin)
```





# å››ã€é¦–é¡µ

## 1ã€é¦–é¡µ-æ•ˆæœå›¾

<img src="images/é¦–é¡µ.png" alt="é¦–é¡µ" style="zoom:50%;" />



## 2ã€é¦–é¡µ-è½®æ’­å›¾

### APIå±‚å°è£…

#### 2.1  axioså°è£…

åˆ›å»ºæ–‡ä»¶: `utils/request.ts`

#### 2.2 å®‰è£…axios

```sh
npm install axios -S
```



#### 2.3 äºŒæ¬¡å°è£…

```ts
import axios  from 'axios'
import router from '@/router'
import useUserStore from "@/stores/user";


const req= axios.create({
  baseURL:'/foo',
  timeout:5000  // æœ€é•¿è¯·æ±‚æ—¶é•¿
})

req.interceptors.request.use(config=>{
  // ç»„ä»¶å¤–ä½¿ç”¨store,ç°ç”¨ç°å–
  const useStore = useUserStore();
  // ä¼ é€’token
  config.headers.token = useStore.token;


  return  config
},err=>{
  throw err
})

req.interceptors.response.use(res=>{
   const isSuccess=res.data.code==='200'

   if(isSuccess){
    return res.data.data;
   }
},err=>{
  return Promise.reject(err)
})


export default req
```



#### api/base.ts:

http://121.89.205.189:3000/api/banner/list

```ts
// å¯¼å‡ºæ‰€æœ‰çš„æ¥å£
const base = {
  banner: "/banner/list",
};

export default base;
```



#### banner.ts

```ts
import base from "./base";
// å¯¼å…¥äºŒæ¬¡å°è£…
import req from "@/utils/request";

/**
 * é¦–é¡µè½®æ’­å›¾
 * @returns
 * å®šä¹‰æ¥å£çš„æ—¶å€™ï¼Œå°±è¯´æ˜è¿”å›ä»€ä¹ˆä¸œè¥¿
 */
export const getBannerListApi = () =>
  req.get<any, BannerNS.IBannerItem[]>(base.banner);

```



#### 2.4 æ¶ˆæ¯æç¤º

å¼•å…¥å‡½æ•°ç»„ä»¶çš„æ ·å¼

Vant ä¸­æœ‰ä¸ªåˆ«ç»„ä»¶æ˜¯ä»¥å‡½æ•°çš„å½¢å¼æä¾›çš„ï¼ŒåŒ…æ‹¬ `Toast`ï¼Œ`Dialog`ï¼Œ`Notify` å’Œ `ImagePreview` ç»„ä»¶ã€‚åœ¨ä½¿ç”¨å‡½æ•°ç»„ä»¶æ—¶ï¼Œ`unplugin-vue-components` æ— æ³•è‡ªåŠ¨å¼•å…¥å¯¹åº”çš„æ ·å¼ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å¼•å…¥æ ·å¼ã€‚

```js
// Toast
import { showToast } from 'vant';
import 'vant/es/toast/style';

// Dialog
import { showDialog } from 'vant';
import 'vant/es/dialog/style';

// Notify
import { showNotify } from 'vant';
import 'vant/es/notify/style';

// ImagePreview
import { showImagePreview } from 'vant';
import 'vant/es/image-preview/style';
```



ä½ å¯ä»¥åœ¨é¡¹ç›®çš„å…¥å£æ–‡ä»¶æˆ–å…¬å…±æ¨¡å—ä¸­å¼•å…¥ä»¥ä¸Šç»„ä»¶çš„æ ·å¼ï¼Œè¿™æ ·åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œä¾¿ä¸å†éœ€è¦é‡å¤å¼•å…¥æ ·å¼äº†ã€‚

```ts
// Notify
import { showNotify } from "vant";
import "vant/es/notify/style";

// token è¿‡æœŸ
showNotify({ type: "danger", message: "ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•" });
```



#### 2.5 è®¾ç½®ä»£ç†

```js
server:{
    // å¼€å¯çƒ­æ›´æ–°ï¼Œå¦åˆ™é¡µé¢æ€»æ˜¯ä¸æ›´æ–°
    hmr:true,
    proxy: {
      '/foo': {
        // http://121.89.205.189:3000/api/banner/list
        target: 'http://121.89.205.189:3000/api',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/foo/, ''),
        }
    }
  }
```





### åˆ›å»ºå…¨å±€å£°æ˜æ–‡ä»¶

**vue3_moblieshop3/@types/banner.d.tsï¼š** æ ¹æ®åç«¯ç»™çš„æ¥å£æ–‡æ¡£ï¼Œå®šä¹‰å£°æ˜æ–‡ä»¶ï¼š

é€šå¸¸ï¼Œå°†ä¸€äº›å…¨å±€çš„ç±»å‹å£°æ˜æ”¾ç½®åˆ°é¡¹ç›®æ ¹ç›®å½•@typeä¸­ï¼Œéœ€è¦åˆ©ç”¨ declare namespaceæ¥ç®€åŒ–ä½¿ç”¨æ–¹å¼ã€‚

```ts
//@types/banner.d.ts
 declare namespace BannerNS{
   interface IBannerItem{
    alt:string,
    bannerid:string,
    flag:boolean,
    img:string,
    link:string
  }
}
```

#### ç›®å½•é…ç½®

é€šå¸¸ä¼šå°†å…¨å±€æ€§çš„å£°æ˜æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„@typesç›®å½•ä¸­ï¼Œæ­¤æ—¶åœ¨ tsconfig.jsonä¸­åº”è¯¥å»includeè¿›æ¥ï¼Œæ‰èƒ½ç”Ÿæ•ˆã€‚

tsconfig.jsonï¼š

```json
"include": ["env.d.ts", "src/**/*", "src/**/*.vue","@types/**/*.d.ts"],

// "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"]
```



#### ç•Œé¢ä¸­ä½¿ç”¨

```ts
// æ— éœ€importå¯¼å…¥
const bannerList = ref<BannerNS.IBannerItem[]>([]);
```





## 3ã€é¦–é¡µ-åå®«æ ¼

### æ•ˆæœå›¾

<img src="images/é¦–é¡µ.png" alt="é¦–é¡µ" style="zoom:50%;" /><img src="images/åˆ—è¡¨é¡µ.png" alt="åˆ—è¡¨é¡µ" style="zoom:50%;" />      



#### åŠŸèƒ½æè¿°

1. åŠ¨æ€æ¸²æŸ“åå®«æ ¼
2. ç‚¹å‡»è·³è½¬åˆ°åˆ—è¡¨é¡µ     `/list?search=é”‹è´­è¶…å¸‚`

#### AppMain/components/AppMainNavList/index.vue

Vantç»„ä»¶ï¼šå¯¼èˆªç»„ä»¶/Grid å®«æ ¼



```vue
<script setup lang="ts">
import { useRouter, type Router } from "vue-router";
const navs = [
  {
    navId: 1,
    text: "é”‹è´­è¶…å¸‚",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/175540/24/19329/6842/60ec0b0aEf35f7384/ec560dbf9b82b90b.png!q70.jpg",
  },
  {
    navId: 2,
    text: "æ•°ç ç”µå™¨",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/178015/31/13828/6862/60ec0c04Ee2fd63ac/ccf74d805a059a44.png!q70.jpg",
  },
  {
    navId: 3,
    text: "é”‹è´­ç™¾è´§",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/54043/33/19389/4660/62b049dbE3b9aef75/2fcd31afd5d702e4.png!q70.jpg",
  },
  {
    navId: 4,
    text: "é”‹è´­ç”Ÿé²œ",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/177902/16/13776/5658/60ec0e71E801087f2/a0d5a68bf1461e6d.png!q70.jpg",
  },
  {
    navId: 5,
    text: "é”‹è´­åˆ°å®¶",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/196472/7/12807/7127/60ec0ea3Efe11835b/37c65625d94cae75.png!q70.jpg",
  },
  {
    navId: 6,
    text: "é”‹è´­å……å€¼",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/185733/21/13527/6648/60ec0f31E0fea3e0a/d86d463521140bb6.png",
  },
  {
    navId: 7,
    text: "é”‹è´­3C",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/145692/9/1817/4493/5efbf652E61c4f3ec/722840c121d67fc6.png",
  },
  {
    navId: 8,
    text: "é”‹è´­é¢†åˆ¸",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/186080/16/13681/8175/60ec0fcdE032af6cf/c5acd2f8454c40e1.png",
  },
  {
    navId: 9,
    text: "é”‹è´­ä¼šå‘˜",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/37709/6/15279/6118/60ec1046E4b5592c6/a7d6b66354efb141.png",
  },
  {
    navId: 10,
    text: "é”‹è´­å›½é™…",
    url: "https://m15.360buyimg.com/mobilecms/jfs/t1/191060/24/12861/6818/60ec11f2E67cf5ee6/c264378678b3cd96.png",
  },
];

const router: Router = useRouter();
// å¯¼èˆªåˆ°åˆ—è¡¨é¡µ
const handleToList = (title: string) => {
  router.push({ name: "list", query: { search: title } });
};
</script>
```





## 4ã€é¦–é¡µ-å•†å“åˆ—è¡¨

### æ¥å£ï¼š

#### Pro - è·å–å•†å“åˆ†é¡µåˆ—è¡¨æ•°æ®

GET

```http
http://121.89.205.189:3000/api/pro/list
```

å‚æ•°

| å­—æ®µ     | ç±»å‹   | æè¿°                    |
| :------- | :----- | :---------------------- |
| count    | Number | é¡µç ,é»˜è®¤å€¼ä¸º1          |
| limitNum | Number | æ¯é¡µæ˜¾ç¤ºä¸ªæ•°,é»˜è®¤å€¼ä¸º10 |



### å®ç°

#### api/base.ts

```js
prolist: "/pro/list",
```



#### api/index.ts

```ts
// å®šä¹‰æ¥å£
export interface IPageParams {
  count: number;
  limitNum?: 6;
}

/**
 * è·å–å•†å“åˆ—è¡¨
 * @returns
 * http://121.89.205.189:3000/api/pro/list
 */
export const getProListApi = (params: IPageParams) =>
  req.get<any, GoodsNS.IGoodsItem[]>(base.prolist, { params });
```



#### @types/pro.d.ts:

```ts
// å•†å“å¯¹è±¡æ¥å£
declare namespace GoodsNS {
    
  interface IGoodsItem {
    readonly proid: string;
    proname: string;
    originprice: number;
    category: string;
    brand: string;
    desc: string;
    img1: string;
    discount: number;
    // å¤šåŠ ä¸€ä¸ªè½®æ’­å›¾å±æ€§
    banners: string[];
  }
}

```



#### å°è£…é€šç”¨ç»„ä»¶

å•†å“åˆ—è¡¨åœ¨å¾ˆå¤šé¡µé¢éƒ½ä¼šç”¨åˆ°ï¼Œå› æ­¤å°è£…ä¸€ä¸ªé€šç”¨çš„ç»„ä»¶CommonListï¼Œå¯å¤šæ¬¡å¤ç”¨ã€‚

æ¢³ç†ä¸åŒï¼š

1. å¸ƒå±€æ–¹å¼ä¸åŒï¼šä¸€è¡Œä¸€ä¸ªã€ä¸€è¡Œä¸¤ä¸ª   é€šè¿‡ä¼ é€’åŠ¨æ€å±æ€§ columnå®ç°
2. è°ƒç”¨æ¥å£ä¸åŒï¼šé€šè¿‡ä¼ é€’ä¸åŒçš„è¯·æ±‚æ–¹æ³• actionå®ç°

ç»„ä»¶å†…ç½®ä¸šåŠ¡ï¼šå¸ƒå±€ã€è‡ªåŠ¨è·å–æ•°æ®ã€ä¸Šæ‹‰åŠ è½½æ›´å¤š



## 5ã€å°è£…é€šç”¨çš„å•†å“åˆ—è¡¨

### æ•ˆæœå›¾

<img src="images/é¦–é¡µ.png" alt="é¦–é¡µ" style="zoom:50%;" /><img src="images/ä¸€åˆ—.png" alt="ä¸€åˆ—" style="zoom:50%;" />    

å•†å“åˆ—è¡¨ï¼Œåœ¨æœ‰çš„é¡µé¢æ˜¾ç¤ºæˆä¸€åˆ—ï¼ˆå·¦è¾¹å›¾ç‰‡ï¼Œå³ä¾§å•†å“ä¿¡æ¯ï¼‰ï¼Œæœ‰çš„é¡µé¢æ˜¾ç¤ºæˆä¸¤åˆ—ï¼ˆä¸Šé¢å›¾ç‰‡ï¼Œä¸‹é¢å•†å“ä¿¡æ¯ï¼‰ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å°è£…é€šç”¨çš„å•†å“åˆ—è¡¨ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„åˆ—æ•°ï¼Œå±•ç¤ºæ•ˆæœã€‚

### å°è£…ç»“æ„

Vantç»„ä»¶ï¼šå±•ç¤ºç»„ä»¶/List åˆ—è¡¨

https://vant-contrib.gitee.io/vant/#/zh-CN/list

#### components/CommonList/index.vue

```vue
<template>
  <div class="common-list">
    <!-- immediate-check	æ˜¯å¦åœ¨åˆå§‹åŒ–æ—¶ç«‹å³æ‰§è¡Œæ»šåŠ¨ä½ç½®æ£€æŸ¥	boolean	true -->
    <van-list
      v-model:loading="loading"
      :finished="finished"
      finished-text="æ²¡æœ‰æ›´å¤šäº†"
      @load="onLoad"
      :immediate-check="false"
    >
      <!-- å¾ªç¯ -->
      <van-cell
        v-for="item in goodsList"
        :key="item.proid"
        :title="item.proname"
      />
    </van-list>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from "vue";
import { getProListApi, type IPageParams } from "@/api";


export interface IProps {
  action(): any;
  column?: 1 | 2; //ä¸€åˆ—ï¼Œè¿˜æ˜¯ä¸¤åˆ—
}
const { column = 1, action } = defineProps<IProps>();

const loading = ref<boolean>(false);
const finished = ref<boolean>(false);
//å•†å“åˆ—è¡¨
const goodsList = ref<GoodsNS.IGoodsItem[]>([])
// å®šä¹‰é¡µç ä¿¡æ¯
const pageInfo = reactive<IPageParams>({
  count: 1,
  limitNum: 10,
});

const onLoad = async () => {
  try {
    const res = await getProListApi(pageInfo)
    console.log(res)
    goodsList.value = goodsList.value.concat(res)
    // åŠ è½½ç»“æŸ
    loading.value = false
    // æ•°æ®å·²å…¨éƒ¨åŠ è½½å®Œæ¯•
    if (res.length === 0) {
      finished.value = true
    }
    // é¡µç +1
    pageInfo.count++
  } catch (error) {
    console.log(error)
  }
};

onMounted(() => {
  onLoad();
});
</script>

<style scoped>
.common-list {
  margin-bottom: 50px;
  padding: 0 10px;
}
</style>

```



#### Bug:ä¸€ä¸Šæ¥è·å–äº†ä¸¤æ¬¡ç¬¬ä¸€é¡µæ•°æ®

ä¸€å¼€å§‹å®¹å™¨æ²¡æ’‘å¼€ï¼Œé«˜åº¦æ²¡æœ‰ï¼Œè§¦å‘ä¸€æ¬¡ã€‚

è§£å†³ï¼š

```html
 <!-- immediate-check	æ˜¯å¦åœ¨åˆå§‹åŒ–æ—¶ç«‹å³æ‰§è¡Œæ»šåŠ¨ä½ç½®æ£€æŸ¥	boolean	true -->
```



##### æ‰“æŠ˜å°æ ‡ç­¾

**Vantç»„ä»¶ï¼šå±•ç¤ºç»„ä»¶/Tagæ ‡ç­¾**

https://vant-contrib.gitee.io/vant/#/zh-CN/tag

```vue
<van-tag color="#7232dd" plain>æ ‡ç­¾</van-tag>
```



##### æœ€å¤šæ˜¾ç¤ºä¸¤è¡Œï¼š

**Vantç»„ä»¶ï¼šåŸºç¡€ç»„ä»¶/Styleå†…ç½®æ ·å¼**

https://vant-contrib.gitee.io/vant/#/zh-CN/style

```vue
<!-- æœ€å¤šæ˜¾ç¤ºä¸¤è¡Œ -->
<div class="van-multi-ellipsis--l2">
  è¿™æ˜¯ä¸€æ®µæœ€å¤šæ˜¾ç¤ºä¸¤è¡Œçš„æ–‡å­—ï¼Œå¤šä½™çš„å†…å®¹ä¼šè¢«çœç•¥
</div>
```



### åŠ¨æ€å®šåˆ¶

1. æ˜¾ç¤ºå‡ åˆ—ï¼Œç”±çˆ¶ç»„ä»¶å†³å®š
2. ä¸åŒé¡µé¢ï¼Œå±•ç¤ºçš„åˆ—è¡¨æ•°æ®ä¸åŒ

ä½œç”¨ï¼šæ˜¯å¤–ç•Œä¼ å…¥å‘é€ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ã€‚å³ï¼Œä¸åŒçš„é¡µé¢ä½¿ç”¨è¯¥ç»„ä»¶ï¼Œè¦å±•ç¤ºçš„æ•°æ®ä¸ä¸€å®šä¸€æ ·ï¼Œéœ€è¦æ ¹æ®éœ€æ±‚ï¼Œå»å‘ç½‘ç»œè¯·æ±‚ã€‚



##### ä¼ å…¥æ–¹æ³•ï¼š

```vue
 <!-- ä¸¤åˆ—å•†å“åˆ—è¡¨ -->
<CommonList :column="2" :action="getProListApi" />

<script setup lang="ts">
    import { getProListApi } from "@/api";
</script>
```











# äº”ã€åˆ—è¡¨é¡µ

## æ•ˆæœå›¾

â€‹	<img src="images/åˆ—è¡¨é¡µ.png" alt="åˆ—è¡¨é¡µ" style="zoom:50%;" />



## è·¯ç”±é…ç½®

```ts
import AppList from "@/views/AppList/index.vue";

 {
      path: "/list",
      name: "list",
      component: AppList,
      meta: { hideFooter: true },
    },
```



## å¸ƒå±€

```vue
<template>
  <div class="page app-list">
    <CommonHeader class="app-common_header" back>
      <!-- ä¸­é—´ -->
      <template #title>
        <van-search
          v-model="keyword"
          shape="round"
          background="#d30707"
          placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯"
          @click="handleSearch"
        />
      </template>
    </CommonHeader>
    <!-- è¿‡æ»¤ç»„ä»¶ -->
    <AppListFilter :filters="filters" />
    <!-- å…¬å…±çš„å•†å“åˆ—è¡¨ -->
    <CommonList :action="getProSearchListApi" />
  </div>
</template>
<script setup lang="ts">
import { useRoute, useRouter, type Router } from "vue-router";
// è·å–å•†å“åˆ—è¡¨çš„æ¥å£
import { getProSearchListApi } from "@/api";


const route = useRoute();
// è·å–å‚æ•°
const keyword = ref<string>((route.query.search as string) || "");

  
</script>

<style lang="scss" scoped></style>
```



## åå®«æ ¼å¯¼èˆªåˆ°åˆ—è¡¨

å¯¼èˆªåˆ°å•†å“åˆ—è¡¨é¡µ

**AppMain/AppMainNavList/index.vue**

```diff
<template>
  <div class="app-main_nav-list">
    <van-grid :column-num="5" :border="false">
      <van-grid-item
        v-for="nav in navs"
        :key="nav.navId"
        :icon="nav.url"
        :text="nav.text"
+        @click="handleToList(nav.text)"
      />
    </van-grid>
  </div>
</template>

<script setup lang="ts">
+import { useRouter, type Router } from "vue-router";
+const router: Router = useRouter();
+// å¯¼èˆªåˆ°åˆ—è¡¨é¡µ
+const handleToList = (title: string) => {
+  router.push({ name: "list", query: { search: title } });
+};
</script>
```





# å…­ã€è¯¦æƒ…é¡µ

### æ•ˆæœå›¾

â€‹	<img src="images/è¯¦æƒ…é¡µ.png" alt="è¯¦æƒ…é¡µ" style="zoom:50%;" /><img src="images/è¯¦æƒ…é¡µ2.png" alt="è¯¦æƒ…é¡µ2" style="zoom:50%;" />



### è·¯ç”±é…ç½®ï¼š

```ts
import AppDetail  from '@/views/AppDetail/index.vue'

// æ³¨æ„ï¼šåŠ¨æ€è·¯ç”±ä¼ å‚ params ä¼ å‚æ–¹å¼
{path:'/detail/:proid',name:'detail',component:AppDetail,meta:{hideFooter:true}},
```



### æ¥å£ï¼š

**Pro - è·å–äº§å“çš„è¯¦æƒ…æ•°æ®    GET**

```http
http://121.89.205.189:3000/api/pro/detail/:proid
```

å‚æ•°

| å­—æ®µ  | ç±»å‹   | æè¿°               |
| :---- | :----- | :----------------- |
| proid | String | äº§å“å”¯ä¸€å€¼ï¼Œäº§å“id |

å“åº”

```json
{
  code: '10001',
  message: 'æŠ±æ­‰ï¼Œæ²¡æœ‰æŸ¥æ‰¾åˆ°è¯¥å•†å“'
}
{
  code: '200',
  message: 'è·å–äº§å“çš„è¯¦æƒ…æ•°æ®'
  data: {}
}
```



#### api/base.ts

```ts
proDetail:'/pro/detail', // å•†å“è¯¦æƒ…
```

index.js:

```ts
/**
 * è·å–å•†å“è¯¦æƒ…  /pro/detail/:proid  paramsä¼ å‚
 * @param proid   proid:string
 * @returns 
 */
export const getProDetailApi=(proid:string)=>{
  console.log(`${base.proDetail}/${proid}`);
 return  req.get(`${base.proDetail}/${proid}`)
}
```

#### AppDetail/index.vue

```ts
import { onMounted } from "vue";
import { useRoute } from "vue-router";
import { getProDetailApi } from "../../api";

onMounted(() => {
  getProDetail();
});

const route = useRoute();
const getProDetail = async () => {
  // paramsè·å–å‚æ•°ï¼š
  // console.log("=====", route.params.proid);
  const res = await getProDetailApi(route.params.proid as string);
  proDetail.value = res;
};
```





 

# ä¸ƒã€AppNotFound

#### æ•ˆæœå›¾

<img src="images/NotFound.png" alt="NotFound" style="zoom:50%;" />

#### å±•ç¤ºç»„ä»¶/Empty ç©ºçŠ¶æ€

```vue
<template>
  <div class="page app-not-found">
    <CommonHeader title="Not Found" class="app-common_header" :back="true" />

    <!-- å±•ç¤ºç»„ä»¶  Empty ç©ºçŠ¶æ€-->
    <van-empty description="ä¸€ä¸å°å¿ƒèµ°ä¸¢å–½ğŸ˜­">
      <router-link v-slot="{ navigate }" to="/" custom>
        <van-button @click="navigate" round type="primary" class="bottom-button"
          >è¿˜æ˜¯å›é¦–é¡µå§</van-button
        >
      </router-link>
    </van-empty>
  </div>
</template>

<script setup lang="ts"></script>

<style scoped lang="scss">
.bottom-button {
  width: 160px;
  height: 40px;
}
</style>
```





# å…«ã€ç™»å½•

### æ•ˆæœå›¾

<img src="images/ç™»å½•é¡µ.png" alt="ç™»å½•é¡µ" style="zoom:50%;" />

### é…ç½®è·¯ç”±

```ts
import AppLogin  from '@/views/AppLogin/index.vue'

{path:'/login',name:'login',component:AppLogin,meta:{hideFooter:true}},
```



### å¸ƒå±€

```vue
<template>
  <div class="page">
    <CommonHeader class="app-common_header" title="ç™»å½•">
      <!-- å·¦ä¾§ -->
      <template #left>
        <router-link to="/">
          <van-icon name="apps-o" size="20" color="#fff"></van-icon>
        </router-link>
      </template>
      <template #right>
        <router-link
          v-slot="{ navigate }"
          custom
          :to="{ name: 'register-one' }"
        >
          <span @click="navigate" color="#fff">å»æ³¨å†Œ</span>
        </router-link>
      </template>
    </CommonHeader>
    <!-- Form è¡¨å•-->
    <van-form @submit="onSubmit">
      <van-cell-group inset>
        <!-- è¾“å…¥æ‰‹æœºå· -->
        <van-field
          v-model="loginInfo.loginname"
          type="tel"
          name="tel"
          label="æ‰‹æœºå·"
          placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
          :rules="[
            {
              required: true,
              message: 'è¯·å¡«å†™æ‰‹æœºå·',
              validator: validatorTel,
            },
          ]"
        />
        <van-field
          v-model="loginInfo.password"
          type="password"
          name="pwd"
          label="å¯†   ç "
          placeholder="å¯† ç "
          :rules="[{ required: true, message: 'è¯·å¡«å†™å¯†ç ' }]"
        />
      </van-cell-group>
      <div style="margin: 16px">
        <van-button round block type="primary" native-type="submit">
          æäº¤
        </van-button>
      </div>
    </van-form>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from "vue";
import { phoneReg } from "../../utils/common";

interface ILoginInfo {
  loginname: string;
  password: string;
}

// éªŒè¯æ‰‹æœºå·
const validatorTel = (val) => {
  if (!val) return "æ‰‹æœºå·ä¸èƒ½ä¸ºç©ºï¼";
  console.log(val);
  if (!phoneReg.test(val)) return "æ‰‹æœºå·è¾“å…¥é”™è¯¯";
};

const loginInfo = reactive<ILoginInfo>({
  loginname: "",
  password: "",
});
// ç™»å½•
const onSubmit = (values) => {
  // è°ƒç”¨ç™»å½•æ¥å£
  console.log("submit", loginInfo);
};
</script>

<style lang="scss"></style>

```



### utils/common.tsï¼š

å°è£…æ­£åˆ™ï¼š

```ts
export const phoneReg =
  /^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1589]))\d{8}$/;
```





### æ¥å£

#### User - è´¦æˆ·å/æ‰‹æœºå·/é‚®ç®± + å¯†ç çš„ç™»å½•æ–¹å¼

POST

```http
http://121.89.205.189:3000/api/user/login
```

#### å‚æ•°

| å­—æ®µ      | ç±»å‹   | æè¿°               |
| :-------- | :----- | :----------------- |
| loginname | String | è´¦æˆ·å/æ‰‹æœºå·/é‚®ç®± |
| password  | String | å¯†ç                |

#### æˆåŠŸè¿”å›

```ts
{
   code: '200',
   message: 'ç™»å½•æˆåŠŸ',
   data: {
     token,
     userid
   }
 }
```



base.ts:

```ts
login: "/user/login", // ç™»å½•      
```



user.ts:

```ts

// å®šä¹‰ç™»å½•å‚æ•°æ¥å£
export interface ILoginParams {
  loginname: string;
  password: string;
}

/**
 * ç™»å½•æ¥å£ postè¯·æ±‚
 * @param userinfo:ILoginParams{ loginname: string; password: string }
 * @returns   { token: string; userid: string }
 */
export const postLoginApi = (params: ILoginParams) =>
  req.post<any, { token: string; userid: string }>(base.login, params);
```







# ä¹ã€ä»“åº“æ­å»º

## è·å–ç”¨æˆ·ä¿¡æ¯


GET

```http
http://121.89.205.189:3000/api/user/info
```

å‚æ•°

| å­—æ®µ   | ç±»å‹   | æè¿°   |
| :----- | :----- | :----- |
| userid | String | ç”¨æˆ·id |



Base.ts

```ts
userinfo: "/user/info", //è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£
```

user.ts:

```ts
/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 * @param userid ï¼šstring
 * @returns
 */
export const getUserinfoApi = (userid: string) =>
  req.get<any, UserNS.IUserInfo>(base.userinfo, { params: { userid } });
```



### @types/user.d.ts

User - è·å–ç”¨æˆ·ä¿¡æ¯   è¾“å…¥tokenå’Œuseridï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ã€‚

```ts
declare namespace UserNS {
  interface IUserInfo {
    userid: string;
    username: string;
    tel?: string;
    nickname: string;
    avatar?: string;
    createTime?: string;
  }
}

```





## Piniaæ­å»ºä»“åº“

### stores/user.ts

```ts

```





## è°ƒç™»å½•æ¥å£

ç”¨pinia-plugin-persistedstate æœ¬åœ°å­˜å‚¨

#### æ­¥éª¤ï¼š

1. å®‰è£…

   ```bash
   npm install --save pinia-plugin-persistedstate
   ```

   

2. main.tsä¸­å¯¼å…¥ï¼Œå¹¶å®‰è£…

   ```js
   // å¯¼å…¥æŒä¹…åŒ–æ’ä»¶ï¼Œå¹¶å®‰è£…åˆ°pinia
   import { createPinia } from 'pinia'
   import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'
   
   const pinia = createPinia()
   pinia.use(piniaPluginPersistedstate)
   ```

   

#### è¯·æ±‚æ‹¦æˆªï¼Œå¸¦token







## ç•Œé¢å®Œå–„

### ä¸»é¡µï¼šAppMain/index.vue

```vue
<!-- å³ä¾§ -->
<template #right>
    <span v-if="isLogin"> {{ userinfo.nickname }}</span>
    <router-link v-else to="/login" custom v-slot="{ navigate }">
      <span @click="navigate" color="#fff">ç™»å½•</span>
    </router-link>
</template>
```





```ts
import { storeToRefs } from "pinia";
import useUserStore from "../../stores/user";

const userStore = useUserStore();
const { isLogin, userinfo } = storeToRefs(userStore);


```





### è¯¦æƒ…é¡µï¼šAppDetail/index.vue:

```ts
import { storeToRefs } from "pinia";
import useUserStore from "../../stores/user";

const userStore = useUserStore();
const { isLogin, userinfo } = storeToRefs(userStore);
```



```vue
<!-- åŠ å…¥è´­ç‰©è½¦ ä¸šåŠ¡ç»„ä»¶ï¼šSubmitBar æäº¤è®¢å•æ  -->
<van-submit-bar
                :disabled="!isLogin"
                :price="proDetail.originprice * 100"
                :button-text="isLogin ? åŠ å…¥è´­ç‰©è½¦ : 'å»ç™»å½•'"
                @submit="handleAddCart"
                />
```







### è´­ç‰©è½¦ï¼šAppCart/index.vue

```ts
import { storeToRefs } from "pinia";
import useUserStore from "../../stores/user";

const userStore = useUserStore();
const { isLogin, userinfo } = storeToRefs(userStore);
```



```vue
 <!-- æ²¡æœ‰ç™»å½•æ˜¾ç¤º -->
<van-empty v-if="!isLogin" description="è¯·ç™»å½•åæŸ¥çœ‹å“¦ğŸ˜¯">
    <router-link v-slot="{ navigate }" :to="{ name: 'login' }" custom>
        <van-button @click="navigate" round type="primary" class="bottom-button"
                    >é©¬ä¸Šç™»å½•</van-button
            >
    </router-link>
</van-empty>
<!-- ç™»å½•åæ˜¾ç¤º -->
<div v-else>
     <template v-if="cartList">
	 </template>

     <van-empty v-else description="è´­ç‰©è½¦ç©ºç©ºä¹ŸğŸ˜’ï¼Œå¿«å»è£…æ»¡å§" />
</div>
```







# åã€é€€å‡ºç™»å½•

### æ•ˆæœå›¾

â€‹	<img src="images/æœªç™»å½•.png" alt="æœªç™»å½•" style="zoom: 50%;" /><img src="images/å·²ç™»å½•.png" alt="å·²ç™»å½•" style="zoom:50%;" />

### user.ts

```ts
// é€€å‡ºç™»å½•===ã€‹action
const exitAction = () => {
    router.push("/"); //å›é¦–é¡µ
};

return { userinfo, token, isLogin, loginAction, exitAction };
```







# åä¸€ã€æ³¨å†Œ

### æ³¨å†Œ-Step1 ï¼šéªŒè¯æ‰‹æœºå·æ˜¯å¦è¢«æ³¨å†Œè¿‡

<img src="images/register-step1.png" alt="register-step1" style="zoom:50%;" />



```vue
<template>
  <CommonHeader class="app-common_header" title="æ³¨å†Œ-Step1ï¼š éªŒè¯æ‰‹æœºå·" back>
  </CommonHeader>
  <!-- Form è¡¨å•  -->
  <van-form @submit="onSubmit">
    <van-cell-group inset>
      <van-field
        v-model="tel"
        type="tel"
        name="tel"
        label="æ‰‹æœºå·"
        placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
        :rules="[
          {
            required: true,
            message: 'è¯·å¡«å†™æ‰‹æœºå·',
            validator: validatorTel,
          },
        ]"
      />
    </van-cell-group>
    <div style="margin: 16px">
      <van-button round block type="primary" native-type="submit">
        ä¸‹ä¸€æ­¥
      </van-button>
    </div>
  </van-form>
</template>

<script setup lang="ts">
import { ref } from "vue";
import { useRouter } from "vue-router";
import { phoneReg } from "../../utils/common";
const tel = ref<string>("");
// éªŒè¯æ‰‹æœºå·
const validatorTel = (val) => {
  if (!val) return "æ‰‹æœºå·ä¸èƒ½ä¸ºç©ºï¼";
  // console.log(tel);
  if (!phoneReg.test(val)) return "æ‰‹æœºå·è¾“å…¥é”™è¯¯";
};

const router = useRouter();

// ä¸‹ä¸€æ­¥
const onSubmit = () => {
  console.log(tel);

  // éªŒè¯æ‰‹æœºå·æ˜¯å¦è¢«æ³¨å†Œè¿‡
  router.push({ name: "register-two", query: { tel: tel.value } });
};
</script>

<style lang="scss" scoped></style>

```







### æ³¨å†Œ-Step2 ï¼š  è¾“å…¥éªŒè¯ç 

<img src="images/register-step2.png" alt="register-step2" style="zoom:50%;" />



##### æ’å…¥æŒ‰é’®

é€šè¿‡ button æ’æ§½å¯ä»¥åœ¨è¾“å…¥æ¡†å°¾éƒ¨æ’å…¥æŒ‰é’®ã€‚







### æ³¨å†Œ-Step3 ï¼š  è¾“å…¥å¯†ç 

<img src="images/register-step3.png" alt="register-step3" style="zoom:50%;" />



### æ¥å£

POST

```http
http://121.89.205.189:3000/api/user/dofinishregister
```

å‚æ•°

| å­—æ®µ     | ç±»å‹   | æè¿°     |
| :------- | :----- | :------- |
| tel      | String | æ‰‹æœºå·ç  |
| password | String | å¯†ç      |



Tel:  13211111111    13333333333

Pwdï¼š 111111         123456

![æµ‹è¯•æ³¨å†Œæ¥å£](images/æµ‹è¯•æ³¨å†Œæ¥å£.png)











### ä¼˜åŒ–ï¼š

è¾“å…¥ä¿¡æ¯æ ¡éªŒé€šè¿‡ï¼Œæ‰å¯ä»¥ç‚¹å‡»æŒ‰é’®ï¼Œå¦åˆ™ï¼Œä¸å¯ç‚¹å‡»çŠ¶æ€ã€‚

```vue
<div style="margin: 16px">
        <van-button
          :disabled="!canNext"
          round
          block
          type="primary"
          native-type="submit"
        >
          æäº¤
        </van-button>
</div>
```



```ts
// èƒ½å¦ç‚¹å‡»ä¸‹ä¸€æ­¥
const canNext = computed<boolean>(() => {
  if (!loginInfo.loginname) return false; //ç”¨æˆ·åä¸å­˜åœ¨
  if (!loginInfo.password) return false; //å¯†ç ä¸å­˜åœ¨
  if (!phoneReg.test(loginInfo.loginname)) return false; //æ‰‹æœºå·ä¸ç¬¦åˆ
  // å¦åˆ™ï¼Œè¿”å›true
  return true;
});
```









# åäºŒã€è´­ç‰©è½¦

## æ•ˆæœå›¾

â€‹	<img src="images/è´­ç‰©è½¦_1.png" alt="è´­ç‰©è½¦_1" style="zoom:40%;" /><img src="images/è´­ç‰©è½¦_2.png" alt="è´­ç‰©è½¦_2" style="zoom:40%;" /><img src="images/è´­ç‰©è½¦_3.png" alt="è´­ç‰©è½¦_3" style="zoom:40%;" />



#### AppCart/index.vue

```vue
<template>
  <div class="page app-cart">
    <CommonHeader title="è´­ç‰©è½¦" class="app-common_header" />
    <!-- æ²¡æœ‰ç™»å½•æ˜¾ç¤º -->
    <van-empty v-if="!token" description="è¯·ç™»å½•åæŸ¥çœ‹å“¦ğŸ˜¯">
      <router-link v-slot="{ navigate }" :to="{ name: 'login' }" custom>
        <van-button @click="navigate" round type="primary" class="bottom-button"
          >é©¬ä¸Šç™»å½•</van-button
        >
      </router-link>
    </van-empty>
    <!-- ç™»å½•åæ˜¾ç¤º -->
    <div v-else>
      <template v-if="cartList">
        <van-card
          v-for="item in cartList"
          :key="item.cartid"
          :num="item.num"
          :price="item.originprice"
          :title="item.proname"
          :thumb="item.img1"
        >
          <template #tags>
            <van-tag plain type="primary">æ ‡ç­¾</van-tag>
            <van-tag plain type="primary">æ ‡ç­¾</van-tag>
          </template>
          <template #footer>
            <van-button size="mini">-</van-button>
            <van-button size="mini">+</van-button>
          </template>
        </van-card>
      </template>

      <van-empty v-else description="è´­ç‰©è½¦ç©ºç©ºä¹ŸğŸ˜’ï¼Œå¿«å»è£…æ»¡å§" />
      <van-submit-bar
        class="cart-bottom"
        :price="3050"
        button-text="æäº¤è®¢å•"
        @submit="onSubmit"
      >
        <van-checkbox v-model="checkedAll">å…¨é€‰</van-checkbox>
      </van-submit-bar>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from "vue";
import type { ICartItem } from "@/@types/pro.d";
const token = ref<string>("dsfs");
// è´­ç‰©è½¦åˆ—è¡¨
const cartList = ref<ICartItem[]>([]);

// å…¨é€‰
const checkedAll = ref<boolean>(false);
</script>

<style scoped lang="scss">
.bottom-button {
  width: 160px;
  height: 40px;
}
.app-cart {
  .cart-bottom {
    margin-bottom: 50px;
  }
}
</style>
```





## Cart - æŸ¥çœ‹è´­ç‰©è½¦

### åŠŸèƒ½æè¿°

è´­ç‰©è½¦ï¼ŒåŠ è½½è´­ç‰©è½¦åˆ—è¡¨ï¼ŒæŒ‡å·²ç»åŠ åˆ°è´­ç‰©è½¦çš„å•†å“ã€‚

### æ¥å£æ–‡æ¡£

POST

```http
http://121.89.205.189:3000/api/cart/list
```

Header

| å­—æ®µ  | ç±»å‹   | æè¿°  |
| :---- | :----- | :---- |
| token | String | token |

å‚æ•°

| å­—æ®µ   | ç±»å‹   | æè¿°   |
| :----- | :----- | :----- |
| userid | String | ç”¨æˆ·id |

è¿”å›

```json
{
    "code": "10020",
    "message": "è´­ç‰©è½¦æ•°æ®ä¸ºç©º"
}
```



### å…·ä½“å®ç°

#### base.ts:

```ts
cartList: "/cart/list", // æŸ¥çœ‹è´­ç‰©è½¦åˆ—è¡¨
```

#### cart.ts:

```ts
/**
 * æŸ¥çœ‹è´­ç‰©è½¦åˆ—è¡¨ postè¯·æ±‚
 * @param     userid: string  ç”¨æˆ·id
 * @returns   CartNS.ICartItem[] è´­ç‰©è½¦åˆ—è¡¨æ•°æ®
 */
export const postCartListApi = (userid: string) =>
  req.post<any, CartNS.ICartItem[]>(base.cartList, { userid });
```



#### @types/cart.d.ts

```ts
// è´­ç‰©è½¦å£°æ˜æ–‡ä»¶
declare namespace CartNS{
   interface ICartItem {
    readonly cartid:string,
    readonly userid:string,
    num:number,
    flag:boolean,
    img1:string,
    proname:string,
    originprice:number,
    readonly proid:string,
    discount:number,  
  }
}
```



##### AppCart/index.vue

```ts
import { postCartListApi } from "../../api/cart";


onMounted(() => {
  console.log(isLogin.value); //ComputedRefImplç±»å‹çš„ï¼Œå¾— value

  // ç™»å½•äº†ï¼Œå†åŠ è½½åˆ—è¡¨
  if (isLogin.value) {
    loadCartList();
  }
});

// è´­ç‰©è½¦åˆ—è¡¨
const cartList = ref<CartNS.ICartItem[]>([]);
// åŠ è½½è´­ç‰©è½¦åˆ—è¡¨
const loadCartList = async () => {
  try {
    const res = await postCartListApi(userinfo.value.userid);
    // æœ‰å¯èƒ½æ˜¯undefinedï¼Œè´­ç‰©è½¦æ²¡æ•°æ®ã€‚æœ‰å€¼æ²¡å€¼éƒ½èµ‹å€¼
    cartList.value = res;
  } catch (error) {
    console.log(error);
  }
};
```





## Cart - åŠ å…¥è´­ç‰©è½¦

### åŠŸèƒ½æè¿°

å•†å“è¯¦æƒ…é¡µï¼Œæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ã€‚

### æ¥å£æ–‡æ¡£

POST

```http
http://121.89.205.189:3000/api/cart/add
```

Header

| å­—æ®µ  | ç±»å‹   | æè¿°  |
| :---- | :----- | :---- |
| token | String | token |

å‚æ•°

| å­—æ®µ   | ç±»å‹   | æè¿°           |
| :----- | :----- | :------------- |
| userid | String | ç”¨æˆ·id         |
| proid  | String | äº§å“id         |
| num    | Number | åŠ å…¥è´­ç‰©è½¦æ•°é‡ |

æˆåŠŸè¿”å›

```json
{
  code: '200',
  data:1
  message: 'åŠ å…¥è´­ç‰©è½¦æˆåŠŸ'
}
```



### å…·ä½“å®ç°

```ts
addCart: "/cart/add", //åŠ å…¥è´­ç‰©è½¦
```



```ts
// å®šä¹‰åŠ å…¥è´­ç‰©è½¦å•†å“æ¥å£
export interface IAddCartItem {
  userid: string; // ç”¨æˆ·id
  proid: string; //äº§å“id
  num: number; //åŠ å…¥è´­ç‰©è½¦æ•°é‡
}

/**
 * åŠ å…¥è´­ç‰©è½¦
 * @param params: IAddCartItem
 * @returns  æ— è¿”å›
 */
export const postAddCartApi = (params: IAddCartItem) => {
  return req.post<any, null>(base.addCart, params);
};

```



#### è¯¦æƒ…é¡µè°ƒç”¨





## Cart - æ›´æ–°è´­ç‰©è½¦æ•°é‡

### åŠŸèƒ½æè¿°

è´­ç‰©è½¦åˆ—è¡¨ï¼Œå‘é€ç½‘ç»œè¯·æ±‚ï¼Œç‚¹å‡»åŠ ã€å‡ æ›´æ–°è´­ç‰©è½¦æ•°é‡ã€‚

### æ¥å£æ–‡æ¡£

POST

```http
http://121.89.205.189:3000/api/cart/updatenum
```

Header

| å­—æ®µ  | ç±»å‹   | æè¿°  |
| :---- | :----- | :---- |
| token | String | token |

å‚æ•°

| å­—æ®µ   | ç±»å‹   | æè¿°     |
| :----- | :----- | :------- |
| cartid | String | è´­ç‰©è½¦id |
| num    | Number | æ•°é‡     |



æˆåŠŸè¿”å›

```json
{
  code: '200',
  message: 'æ›´æ–°è´­ç‰©è½¦æ•°é‡'
}
```



### å…·ä½“å®ç°

```ts
// å®šä¹‰æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡æ¥å£
export interface IUpdateNumCartItem {
  cartid: string; // è´­ç‰©è½¦id
  num: number; //åŠ å…¥è´­ç‰©è½¦æ•°é‡
}

/**
 * æ›´æ–°è´­ç‰©è½¦æ•°é‡
 * @param params
 * @returns æ— è¿”å›
 */
export const postUpdateCartNumApi = (params: IUpdateNumCartItem) =>
  req.post<any, null>(base.updatenum, params);
```



#### AppCart/index.vue

ç‚¹å‡»åŠ ã€å‡ æ›´æ–°è´­ç‰©è½¦æ•°é‡

```vue
<template #footer>
<van-button
            :disabled="item.num === 1"
            @click="handleUpdateNum(item.cartid, item.num - 1)"
            size="mini"
            >-</van-button>
<van-button
            @click="handleUpdateNum(item.cartid, item.num + 1)"
            size="mini"
            >+</van-button>
</template>
```



```ts
// æ›´æ–°è´­ç‰©è½¦æ•°é‡
const handleUpdateNum = async (cartid: string, num: number) => {
  try {
    const res = await postUpdateCartNumApi({ cartid, num });
    // ä¿®æ”¹æ•°é‡ä¹‹åï¼Œå†æ¬¡æ›´æ–°åˆ—è¡¨
    loadCartList();
  } catch (error) {
    console.log(error);
  }
};
```







#### 

## Cart - åˆ é™¤è´­ç‰©è½¦å•æ¡æ•°æ®

### åŠŸèƒ½æè¿°

**åé¦ˆç»„ä»¶/SwipeCell æ»‘åŠ¨å•å…ƒæ ¼**

### æ¥å£æ–‡æ¡£

POST

```http
http://121.89.205.189:3000/api/cart/remove
```

Header

| å­—æ®µ  | ç±»å‹   | æè¿°  |
| :---- | :----- | :---- |
| token | String | token |

å‚æ•°

| å­—æ®µ   | ç±»å‹   | æè¿°     |
| :----- | :----- | :------- |
| cartid | String | è´­ç‰©è½¦id |

æˆåŠŸè¿”å›

```json
{
  code: '200',
  message: 'åˆ é™¤è´­ç‰©è½¦å•æ¡æ•°æ®'
}
```



### å…·ä½“å®ç°

```ts
removeCartItem: "/cart/remove", //åˆ é™¤è´­ç‰©è½¦å•æ¡æ•°æ®
```



```ts
/**
 * åˆ é™¤è´­ç‰©è½¦å•æ¡æ•°æ®
 * @param cartid  	è´­ç‰©è½¦id
 * @returns  æ— è¿”å›
 */
export const postRemoveCartItemApi = (cartid: string) =>
  req.post<any, null>(base.removeCartItem, { cartid });
```



#### AppCart/index.vue å³æ»‘åŠ¨ï¼Œåˆ é™¤

```vue
 <template #right>
            <van-button
              @click="handleDelete(item.cartid)"
              square
              text="åˆ é™¤"
              type="danger"
              class="delete-button"
            />
          </template>
```



```ts
// åˆ é™¤å½“å‰å•†å“
const handleDelete = async (cartid: string) => {
  try {
    await postRemoveCartItemApi(cartid);
    // åˆ é™¤ä¹‹åï¼Œé‡æ–°è·å–æ•°æ®ï¼Œåˆ·æ–°å½“å‰åˆ—è¡¨
    loadCartList();
  } catch (error) {
    console.log(error);
  }
};
```







## Cart - æ›´æ–°å•†å“é€‰ä¸­çŠ¶æ€

### åŠŸèƒ½æè¿°

æ¯æ¡è´­ç‰©è½¦å•†å“æ˜¯å¦é€‰ä¸­ï¼Œåº”è¯¥æ˜¯åœ¨åå°åšæ ‡è®°ã€‚

### æ¥å£

POST

```http
http://121.89.205.189:3000/api/cart/selectone
```

Header

| å­—æ®µ  | ç±»å‹   | æè¿°  |
| :---- | :----- | :---- |
| token | String | token |

å‚æ•°

| å­—æ®µ   | ç±»å‹    | æè¿°     |
| :----- | :------ | :------- |
| cartid | String  | è´­ç‰©è½¦id |
| flag   | Boolean | æ˜¯å¦é€‰ä¸­ |

æˆåŠŸè¿”å›

```json
{
  code: '200',
  message: 'æ›´æ–°å½“å‰è´­ç‰©è½¦æ•°æ®çš„é€‰ä¸­çŠ¶æ€'
}
```



###  å…·ä½“å®ç°

```ts

// å®šä¹‰æ›´æ–°é€‰ä¸­çŠ¶æ€æ¥å£
export interface IUpdateSelectCartItem {
  cartid: string; // è´­ç‰©è½¦id
  flag: boolean; //æ˜¯å¦é€‰ä¸­
}

/**
 * æ›´æ–°å½“å‰è´­ç‰©è½¦æ•°æ®çš„é€‰ä¸­çŠ¶æ€
 * @param params params: IUpdateCartItem
 * @returns   æ— è¿”å›
 */
export const postUpdateSelectCartApi = (params: IUpdateSelectCartItem) =>
  req.post<any, null>(base.updateSelectCartItem, params);

```





```vue
 <div class="cart-item">
     <van-checkbox
                   :model-value="item.flag"
                   @update:model-value="handleChangeFlag(item.cartid, !item.flag)"
                   ></van-checkbox>
     <van-card
               :num="item.num"
               :price="item.originprice"
               :title="item.proname"
               :thumb="item.img1"
               >
         <!--ã€‚ã€‚ã€‚ã€‚ã€‚-->
     </van-card>
</div>

<style scoped lang="scss">
.cart-item {
    display: flex;
    background: var(--van-card-background);
    padding-left: 10px;
    .van-card {
      flex: 1;
    }
    .van-checkbox {
      flex-grow: 0;
      flex-shrink: 0; //ä¸æ”¶ç¼©
    }
  }
</style>
```



```ts
// æ›´æ–°å½“å‰è´­ç‰©è½¦æ•°æ®çš„é€‰ä¸­çŠ¶æ€
const handleChangeFlag = async (cartid: string, flag: boolean) => {
  try {
    await postUpdateSelectCartApi({ cartid, flag });
    loadCartList();
  } catch (error) {
    console.log(error);
  }
};
```





## Cart - åé€‰åŠŸèƒ½

å³ æ‰€æœ‰å•†å“é€‰ä¸­ï¼Œåˆ™å…¨é€‰æŒ‰é’®è¢«é€‰ä¸­ï¼Œåªè¦æœ‰ä¸€ä¸ªæ²¡é€‰ä¸­ï¼Œåˆ™ä¸é€‰ä¸­ã€‚

å…¨é€‰æŒ‰é’®çš„çŠ¶æ€ï¼Œä¾èµ–äºæ‰€æœ‰å•†å“å‰é¢çš„å¤é€‰æ¡†æ˜¯å¦é€‰ä¸­ã€‚

```vue
 <van-checkbox
          :model-value="checkedAll"
          @update:model-value="handleCheckAll"
          >å…¨é€‰</van-checkbox
     >
```





## Cart - å…¨é€‰æˆ–å…¨ä¸é€‰

### æè¿°

ç‚¹å‡»å…¨é€‰æŒ‰é’®ï¼Œæ›´æ–°æ‰€æœ‰å•†å“çš„é€‰ä¸­çŠ¶æ€ã€‚

### æ¥å£

POST

```http
http://121.89.205.189:3000/api/cart/selectall
```

Header

| å­—æ®µ  | ç±»å‹   | æè¿°  |
| :---- | :----- | :---- |
| token | String | token |

å‚æ•°

| å­—æ®µ   | ç±»å‹    | æè¿°         |
| :----- | :------ | :----------- |
| userid | String  | ç”¨æˆ·id       |
| type   | Boolean | æ˜¯å¦å…¨éƒ¨é€‰ä¸­ |

æˆåŠŸè¿”å›

```json
{
  code: '200',
  message: 'æ›´æ–°æ‰€æœ‰è´­ç‰©è½¦æ•°æ®çš„é€‰ä¸­çŠ¶æ€'
}
```



### å®ç°

```ts
// å®šä¹‰æ›´æ–°æ‰€æœ‰è´­ç‰©è½¦æ•°æ®çš„é€‰ä¸­çŠ¶æ€æ¥å£
export interface IUpdateAllSelectFlagCartItem {
  userid: string; // ç”¨æˆ·id
  type: boolean; //æ˜¯å¦å…¨éƒ¨é€‰ä¸­
}

/**
 *  æ›´æ–°æ‰€æœ‰è´­ç‰©è½¦æ•°æ®çš„é€‰ä¸­çŠ¶æ€
 * @param params params: IUpdateAllSelectFlagCartItem
 * @returns  æ— è¿”å›
 */
export const postUpdateAllSelectFlagApi = (
  params: IUpdateAllSelectFlagCartItem
) => req.post<any, null>(base.selectall, params);

```



```ts

// å…¨é€‰ ç‚¹å‡»æ‰€æœ‰å•†å“éƒ½é€‰ä¸­
const handleCheckAll = async () => {
  try {
    await postUpdateAllSelectFlagApi({
      userid: userinfo.value.userid,
      type: !checkedAll.value,
    });
    // é‡æ–°è·å–æ•°æ®ï¼Œåˆ·æ–°å½“å‰åˆ—è¡¨
    loadCartList();
  } catch (error) {}
};
```





## Cart - ä»·æ ¼åˆè®¡

```vue
 <van-submit-bar
        class="cart-bottom"
        :price="allPrice * 100"
        button-text="æäº¤è®¢å•"
        @submit="onSubmit"
      >
      </van-submit-bar>
```



```ts
// æ€»ä»·åˆè®¡
const allPrice = computed(() => {
  return cartList.value.reduce((prev, item) => {
    return item.flag ? prev + item.num * item.originprice : prev;
  }, 0);
});
```











#### æ·±å±‚ç©¿é€

```css
/deep/æ˜¯vue2.xä¸­å®ç°æ ·å¼ç©¿é€çš„æ–¹æ¡ˆï¼Œåœ¨vue3.xä¸­ä½¿ç”¨:deep()æ›¿ä»£/deep/

:deep(.title){
	color:pink
}
```


