pinia 就是 Vuex 的升级版，相当于 Vuex5 



#### 1. 基本使用

安装：npm i pinia 

新建 stores 文件夹，下建 countStore.js 文件

```js
import { defineStore } from 'pinia'

export const useCountStore = defineStore('count', {
  state: () => ({
    count: 1
  }),
  getters: {
    doubleCount: (state) => state.count * 2
  },
  actions: {
    addCount(val) {
      this.count += val
    }
  }
})
```

在 main.js 中加载仓库

```js
import { createPinia } from 'pinia'
app.use(createPinia())
```

组件中使用

```vue
<template>
  <div>count: {{ countStore.count }}</div>
  <div>doubleCount: {{ countStore.doubleCount }}</div>
  <p><button @click="countStore.addCount(3)">count++</button></p>
</template>

<script setup>
import { useCountStore } from '@/stores/countStore.js'
const countStore = useCountStore()
console.log(countStore)
</script>
```

##### 1.2. defineStore

defineStore 也可以写成函数形式，更灵活

```js
// ref 就是 state ，computed 就是 getters , function 就是 actions
export const useCounterStore = defineStore('counter', () => {
  const count = ref(1)
  function increment() {
    count.value++
  }
  return { count, increment }
})
```



#### 2. 状态的修改

可直接修改：`countStore.count++`

通过 actions 修改：`countStore.addCount(3)`

仓库数据的解构：`const { count } = storeToRefs(countStore)`

重置 state ：`countStore.$reset()`

批量修改 state ：`countStore.$patch({})` 或者 `countStore.$patch((state)=>{})` ；比一个个修改在性能上有提升

替换 state ：`countStore.$state = {}` ；$state 就是整个仓库

监听 state ：`countStore.$subscribe((mutation, state) => { console.log(mutation, state) })` ；与watch区别，可以拿到旧值，对于 $patch 批量修改只触发一次，且只要调用 $patch 就会触发（无论值是否改变）

##### 

#### 3. Pinia 插件

pinia 插件就是一个函数

##### 3.1. 简单示例

```js
// 在安装此插件后，创建的每个仓库中都会添加一个名为 secret 的属性
function piniaPlugins() {
  return { secret: 'the cake is a lie' }
}

import { createPinia } from 'pinia'
const pinia = createPinia()
pinia.use(piniaPlugins)
```

##### 3.2. 插件的上下文

插件函数可以接收一个参数，即 context ，常解构出 store 进行使用

```js
export function myPiniaPlugin(context) {
  context.pinia // 用 `createPinia()` 创建的 pinia。 
  context.app // 用 `createApp()` 创建的当前应用(仅 Vue 3)。
  context.store // 该插件想扩展的 store
  context.options // 定义传给 `defineStore()` 的 store 的可选对象。
  // ...
}
```

##### 3.3. 为所有的 store 添加公共属性或方法

可以直接通过在一个插件中返回包含特定属性的对象来为每个 store 都添加上特定属性，如 3.1. 简单示例

也可以直接往 store 上添加：   // 这种方式不会被 devtools 追踪

```js
export function piniaPlugins({ store }) {
  store.title = "Hello world！";
  store.sayHi = () => { console.log('hi') }
  store.$subscribe(() => { console.log('store被修改') }); // 每次修改数据都会打印
}
```





















